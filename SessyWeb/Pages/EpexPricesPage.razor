@page "/epexprices"
@inherits PageBase

@using SessyData.Model
@using Radzen
@using static SessyWeb.Components.DateChooserComponent

<RadzenLayout>
    <RadzenHeader>
        <RadzenStack Orientation=Orientation.Horizontal AlignItems="AlignItems.Center" Style="height:100%;margin: 0px; padding: 0px;">
            <RadzenLabel Text="EPEX prices" class="h4 m-2" />

            <DateChooserComponent SelectionChanged="@((DateArgs d) => SelectionChanged(d))" />
        </RadzenStack>
    </RadzenHeader>
    <RadzenBody>
        <RadzenDataGrid @ref="epexPricesGrid"
                        Data="@EPEXPricesList"
                        Context="data"
                        Count="@Count"
                        LoadData="@LoadData"
                        Responsive="true"
                        AllowSorting="true"
                        AllowFiltering="true"
                        AllowPaging="true"
                        PageSize="20"
                        Density="Density.Compact"
                        PagerHorizontalAlign="HorizontalAlign.Center">
            <HeaderTemplate>
                <RadzenButton ButtonStyle="ButtonStyle.Success" Icon="add_circle" Text="Add energy data" Click="@InsertRow" />
            </HeaderTemplate>
            <Columns>
                @if(!HideId)
                {
                    <RadzenDataGridColumn Property="@nameof(EPEXPrices.Id)" Title="Id"/>
                }
                <RadzenDataGridColumn Property="@nameof(EPEXPrices.Time)" Title="Time" SortOrder="SortOrder.Ascending" />
                <RadzenDataGridColumn Property="@nameof(EPEXPrices.Price)" Title="Price" FormatString="{0:F6}">
                    <EditTemplate Context="fr">
                        <RadzenNumeric @bind-Value="fr.Price" 
                                       Style="width:100%"
                                       Format="F6"
                                       InputAttributes="@(new Dictionary<string, object>() { { "aria-label", "Select freight" } })"/>
                    </EditTemplate>
                </RadzenDataGridColumn>
                <RadzenDataGridColumn Context="order" Filterable="false" Sortable="false" TextAlign="TextAlign.Right" Frozen="true" FrozenPosition="FrozenColumnPosition.Right">
                    <Template Context="fr">
                        <RadzenButton Icon="add_circle"
                                      ButtonStyle="ButtonStyle.Success"
                                      Variant="Variant.Flat"
                                      Size="ButtonSize.Small"
                                      Shade="Shade.Lighter"
                                      Click="@(() => InsertAfterRow(fr))"
                                      title="Add new row after this row" />
                        <RadzenButton Icon="edit"
                                      ButtonStyle="ButtonStyle.Light"
                                      Variant="Variant.Flat"
                                      Size="ButtonSize.Small"
                                      class="rz-my-1 rz-ms-1"
                                      Click="@(args => EditRow(fr))"
                                      @onclick:stopPropagation="true" />
                        <RadzenButton Icon="delete"
                                      ButtonStyle="ButtonStyle.Danger"
                                      Variant="Variant.Flat"
                                      Size="ButtonSize.Small"
                                      Shade="Shade.Lighter"
                                      class="rz-my-1 rz-ms-1"
                                      Click="@(args => DeleteRow(fr))"
                                      @onclick:stopPropagation="true" />
                    </Template>
                    <EditTemplate Context="fr">
                        <RadzenButton Icon="check"
                                      ButtonStyle="ButtonStyle.Success"
                                      Variant="Variant.Flat"
                                      Size="ButtonSize.Small"
                                      Click="@((args) => SaveRow(fr))" aria-label="Save" />
                        <RadzenButton Icon="close"
                                      ButtonStyle="ButtonStyle.Light"
                                      Variant="Variant.Flat"
                                      Size="ButtonSize.Small"
                                      class="rz-my-1 rz-ms-1"
                                      Click="@((args) => CancelEdit(fr))" aria-label="Cancel" />
                        <RadzenButton Icon="delete"
                                      ButtonStyle="ButtonStyle.Danger"
                                      Variant="Variant.Flat"
                                      Size="ButtonSize.Small"
                                      Shade="Shade.Lighter"
                                      class="rz-my-1 rz-ms-1"
                                      Click="@(args => DeleteRow(fr))" aria-label="Delete" />
                    </EditTemplate>
                </RadzenDataGridColumn>
            </Columns>
        </RadzenDataGrid>
    </RadzenBody>
</RadzenLayout>
